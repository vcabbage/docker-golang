machine:
  services:
    - docker

dependencies:
  override:
    - pip install docker-squash
    - docker build --rm=false -t golang-intermediate .
    - docker-squash -f 11 -t vcabbage/golang:latest golang-intermediate
    - docker tag vcabbage/golang:latest vcabbage/golang:${CIRCLE_SHA1:0:7}

test:
  override:
    - echo "test"

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
      - docker push vcabbage/golang:latest
      - docker push vcabbage/golang:${CIRCLE_SHA1:0:7}
